---
description: 
alwaysApply: true
enabled: true
updatedAt: 2025-11-13T07:42:49.371Z
provider: 
---

# Wood-ARK é¡¹ç›®çº¦æŸè§„åˆ™

æœ¬è§„åˆ™å®šä¹‰äº† Wood-ARK é¡¹ç›®çš„ç‰¹å®šæŠ€æœ¯çº¦æŸå’Œæ¶æ„è¦æ±‚ï¼Œä¸ç”¨æˆ·çº§é€šç”¨ç¼–ç è§„èŒƒäº’è¡¥ã€‚

## 1. æŠ€æœ¯æ ˆçº¦æŸ

### 1.1 å¿…é¡»ä½¿ç”¨
- **Python ç‰ˆæœ¬**: 3.9+
- **æ ¸å¿ƒä¾èµ–**:
  - `pandas`: æ•°æ®å¤„ç†
  - `requests`: HTTP è¯·æ±‚
  - `python-dotenv`: ç¯å¢ƒå˜é‡ç®¡ç†

### 1.2 ç¦æ­¢ä½¿ç”¨
- âŒ å¼‚æ­¥æ¡†æ¶ (asyncio, aiohttp)
- âŒ ORM æ¡†æ¶ (SQLAlchemy, Django ORM)
- âŒ Web æ¡†æ¶ (Flask, FastAPI, Django)
- âŒ æ•°æ®åº“ç³»ç»Ÿ (MySQL, PostgreSQL, MongoDB)

### 1.3 ç†ç”±
é¡¹ç›®å®šä½ä¸º**è½»é‡çº§æœ¬åœ°å·¥å…·**ï¼Œæ‰€æœ‰é€»è¾‘ä½¿ç”¨åŒæ­¥ä»£ç ï¼Œæ•°æ®å­˜å‚¨ä½¿ç”¨ CSV æ–‡ä»¶ç³»ç»Ÿã€‚

## 2. æ¶æ„çº¦æŸ

### 2.1 å›ºå®šæ¨¡å—ç»“æ„
é¡¹ç›®å¿…é¡»ä¸¥æ ¼éµå¾ªä»¥ä¸‹ 5 ä¸ªæ ¸å¿ƒæ¨¡å—ï¼š

```
src/
â”œâ”€â”€ fetcher.py          # DataFetcher: æ•°æ®è·å–
â”œâ”€â”€ analyzer.py         # Analyzer: æŒä»“å˜åŒ–åˆ†æ
â”œâ”€â”€ reporter.py         # ReportGenerator: Markdown æŠ¥å‘Šç”Ÿæˆ
â”œâ”€â”€ notifier.py         # WeChatNotifier: ä¼ä¸šå¾®ä¿¡é€šçŸ¥
â””â”€â”€ scheduler.py        # Scheduler: è°ƒåº¦é€»è¾‘
```

**ç¦æ­¢**:
- âŒ æ·»åŠ å…¶ä»–ä¸šåŠ¡æ¨¡å—
- âŒ æ‹†åˆ†ç°æœ‰æ¨¡å—ä¸ºå­æ¨¡å—
- âŒ åˆå¹¶å¤šä¸ªæ¨¡å—

### 2.2 æ¨¡å—èŒè´£

#### DataFetcher
```python
class DataFetcher:
    def fetch_holdings(self, etf_symbol: str, date: str) -> pd.DataFrame:
        """è·å–æŒ‡å®šæ—¥æœŸçš„æŒä»“æ•°æ®"""
        pass
    
    def save_to_csv(self, df: pd.DataFrame, etf_symbol: str, date: str) -> None:
        """ä¿å­˜æ•°æ®åˆ° CSV æ–‡ä»¶"""
        pass
```

#### Analyzer
```python
class Analyzer:
    def compare_holdings(self, 
                        current: pd.DataFrame, 
                        previous: pd.DataFrame,
                        threshold: float = 0.05) -> dict:
        """å¯¹æ¯”ä¸¤ä¸ªæ—¥æœŸçš„æŒä»“å˜åŒ–"""
        pass
```

#### ReportGenerator
```python
class ReportGenerator:
    def generate_markdown(self, analysis_result: dict, etf_symbol: str) -> str:
        """ç”Ÿæˆ Markdown æ ¼å¼æŠ¥å‘Š"""
        pass
    
    def save_report(self, content: str, etf_symbol: str, date: str) -> None:
        """ä¿å­˜æŠ¥å‘Šåˆ°æ–‡ä»¶"""
        pass
```

#### WeChatNotifier
```python
class WeChatNotifier:
    def send_markdown(self, content: str) -> bool:
        """å‘é€ Markdown æ¶ˆæ¯åˆ°ä¼ä¸šå¾®ä¿¡"""
        pass
```

#### Scheduler
```python
class Scheduler:
    def should_run_today(self) -> bool:
        """åˆ¤æ–­ä»Šå¤©æ˜¯å¦éœ€è¦è¿è¡Œï¼ˆå‘¨ä¸€åˆ°å‘¨äº”ï¼‰"""
        pass
    
    def get_previous_trading_day(self, current_date: str) -> str:
        """è·å–ä¸Šä¸€ä¸ªäº¤æ˜“æ—¥"""
        pass
```

## 3. æ‰§è¡Œæ¨¡å¼çº¦æŸ

### 3.1 å‘½ä»¤è¡Œå‚æ•°
é¡¹ç›®å¿…é¡»æ”¯æŒä»¥ä¸‹æ‰§è¡Œæ¨¡å¼ï¼š

```bash
# 1. è‡ªåŠ¨æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰- å‘¨ä¸€åˆ°å‘¨äº”è‡ªåŠ¨è¿è¡Œ
python main.py

# 2. æ‰‹åŠ¨æ¨¡å¼ - å¼ºåˆ¶æ‰§è¡Œï¼ˆå¿½ç•¥å·¥ä½œæ—¥æ£€æŸ¥ï¼‰
python main.py --manual

# 3. æŒ‡å®šæ—¥æœŸæ¨¡å¼
python main.py --date 2025-01-15

# 4. æ£€æŸ¥ç¼ºå¤±æ—¥æœŸæ¨¡å¼
python main.py --check-missed

# 5. æµ‹è¯• Webhook æ¨¡å¼
python main.py --test-webhook
```

### 3.2 ä¸»ç¨‹åºç»“æ„
```python
# main.py
import argparse
from src.scheduler import Scheduler
from src.fetcher import DataFetcher
from src.analyzer import Analyzer
from src.reporter import ReportGenerator
from src.notifier import WeChatNotifier

def main():
    parser = argparse.ArgumentParser()
    parser.add_argument('--manual', action='store_true')
    parser.add_argument('--date', type=str)
    parser.add_argument('--check-missed', action='store_true')
    parser.add_argument('--test-webhook', action='store_true')
    args = parser.parse_args()
    
    # è°ƒåº¦é€»è¾‘
    scheduler = Scheduler()
    
    if args.test_webhook:
        # æµ‹è¯• Webhook è¿æ¥
        pass
    elif args.check_missed:
        # æ£€æŸ¥å¹¶è¡¥å……ç¼ºå¤±æ•°æ®
        pass
    else:
        # æ­£å¸¸æ•°æ®è·å–å’Œåˆ†ææµç¨‹
        pass

if __name__ == '__main__':
    main()
```

## 4. æ•°æ®ç®¡ç†çº¦æŸ

### 4.1 æ–‡ä»¶ç³»ç»Ÿç»“æ„
```
data/
â”œâ”€â”€ holdings/
â”‚   â”œâ”€â”€ ARKK/
â”‚   â”‚   â”œâ”€â”€ 2025-01-10.csv
â”‚   â”‚   â”œâ”€â”€ 2025-01-11.csv
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ ARKW/
â”‚   â””â”€â”€ ARKG/
â””â”€â”€ reports/
    â”œâ”€â”€ ARKK/
    â”‚   â”œâ”€â”€ 2025-01-10.md
    â”‚   â””â”€â”€ ...
    â””â”€â”€ ARKW/
```

### 4.2 CSV æ ¼å¼è¦æ±‚
```csv
company,ticker,cusip,shares,market_value,weight
Tesla Inc,TSLA,88160R101,1234567,280500000,10.50
```

**å¿…é¡»åŒ…å«å­—æ®µ**:
- `company`: å…¬å¸åç§°
- `ticker`: è‚¡ç¥¨ä»£ç 
- `shares`: æŒè‚¡æ•°é‡
- `market_value`: å¸‚å€¼
- `weight`: æƒé‡ç™¾åˆ†æ¯”

### 4.3 æ–‡ä»¶å‘½åè§„èŒƒ
- æŒä»“æ•°æ®: `{ETF}/{YYYY-MM-DD}.csv`
- æŠ¥å‘Šæ–‡ä»¶: `{ETF}/{YYYY-MM-DD}.md`

## 5. æŠ¥å‘Šæ ¼å¼çº¦æŸ

### 5.1 Markdown ç»“æ„
æŠ¥å‘Šå¿…é¡»ä¸¥æ ¼éµå¾ªä»¥ä¸‹æ ¼å¼ï¼š

```markdown
# {ETF_SYMBOL} æŒä»“å˜åŒ– ({YYYY-MM-DD})

## ğŸ“Š æ¦‚è§ˆ
- å¯¹æ¯”æ—¥æœŸ: {previous_date} â†’ {current_date}
- æ–°å¢æŒä»“: {count} åª
- ç§»é™¤æŒä»“: {count} åª
- å¢æŒ: {count} åª
- å‡æŒ: {count} åª

## âœ… æ–°å¢æŒä»“
| è‚¡ç¥¨ä»£ç  | å…¬å¸åç§° | æŒè‚¡æ•° | å¸‚å€¼ | æƒé‡ |
|---------|---------|--------|------|------|
| TSLA    | Tesla Inc | 1.2M | $280M | 10.5% |

## âŒ ç§»é™¤æŒä»“
...

## ğŸ“ˆ æ˜¾è‘—å¢æŒ (>{threshold}%)
...

## ğŸ“‰ æ˜¾è‘—å‡æŒ (>{threshold}%)
...

## ğŸ“‹ å®Œæ•´æŒä»“
...
```

### 5.2 Emoji ä½¿ç”¨è§„èŒƒ
- âœ… æ–°å¢æŒä»“
- âŒ ç§»é™¤æŒä»“
- ğŸ“ˆ å¢æŒ
- ğŸ“‰ å‡æŒ
- ğŸ“Š æ¦‚è§ˆ
- ğŸ“‹ å®Œæ•´åˆ—è¡¨

### 5.3 æ•°å€¼æ ¼å¼
- æŒè‚¡æ•°: `1.2M` (ç™¾ä¸‡), `345K` (åƒ)
- å¸‚å€¼: `$280M`, `$12.5B`
- æƒé‡: `10.5%` (ä¿ç•™1ä½å°æ•°)
- å˜åŒ–ç™¾åˆ†æ¯”: `+15.2%`, `-8.3%`

## 6. é…ç½®ç®¡ç†çº¦æŸ

### 6.1 ç¯å¢ƒå˜é‡ (.env)
```bash
# å¿…éœ€é…ç½®
WECHAT_WEBHOOK_URL=https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxx

# å¯é€‰é…ç½®
CHANGE_THRESHOLD=0.05          # æ˜¾è‘—å˜åŒ–é˜ˆå€¼ï¼ˆé»˜è®¤5%ï¼‰
ETF_SYMBOLS=ARKK,ARKW,ARKG     # ç›‘æ§çš„ ETF åˆ—è¡¨
DATA_DIR=./data                # æ•°æ®ç›®å½•
RETRY_TIMES=3                  # é‡è¯•æ¬¡æ•°
RETRY_DELAY=5                  # é‡è¯•å»¶è¿Ÿï¼ˆç§’ï¼‰
```

### 6.2 é…ç½®åŠ è½½
```python
import os
from dotenv import load_dotenv

load_dotenv()

# å¿…é¡»æ£€æŸ¥å¿…éœ€é…ç½®
WEBHOOK_URL = os.getenv('WECHAT_WEBHOOK_URL')
if not WEBHOOK_URL:
    raise ValueError("æœªé…ç½® WECHAT_WEBHOOK_URL ç¯å¢ƒå˜é‡")

# å¯é€‰é…ç½®æä¾›é»˜è®¤å€¼
CHANGE_THRESHOLD = float(os.getenv('CHANGE_THRESHOLD', '0.05'))
ETF_SYMBOLS = os.getenv('ETF_SYMBOLS', 'ARKK,ARKW,ARKG').split(',')
```

## 7. é”™è¯¯å¤„ç†çº¦æŸ

### 7.1 å¿…é¡»å¤„ç†çš„å¼‚å¸¸
```python
# ç½‘ç»œè¯·æ±‚å¤±è´¥
try:
    response = requests.get(url)
    response.raise_for_status()
except requests.RequestException as e:
    logger.error(f"æ•°æ®è·å–å¤±è´¥: {e}")
    # é‡è¯•é€»è¾‘æˆ–å¤±è´¥é€šçŸ¥

# æ–‡ä»¶æ“ä½œå¤±è´¥
try:
    df.to_csv(file_path)
except IOError as e:
    logger.error(f"æ–‡ä»¶ä¿å­˜å¤±è´¥: {e}")

# æ•°æ®è§£æå¤±è´¥
try:
    df = pd.read_csv(file_path)
except pd.errors.ParserError as e:
    logger.error(f"CSV è§£æå¤±è´¥: {e}")
```

### 7.2 æ—¥å¿—è§„èŒƒ
```python
import logging

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('logs/wood_ark.log'),
        logging.StreamHandler()
    ]
)

logger = logging.getLogger(__name__)
```

## 8. æµ‹è¯•çº¦æŸ

### 8.1 å¿…é¡»æµ‹è¯•çš„åœºæ™¯
- âœ… æ•°æ®è·å–æˆåŠŸ/å¤±è´¥
- âœ… CSV æ–‡ä»¶è¯»å†™
- âœ… æŒä»“å˜åŒ–åˆ†æé€»è¾‘
- âœ… Markdown æŠ¥å‘Šç”Ÿæˆ
- âœ… Webhook å‘é€ï¼ˆä½¿ç”¨ mockï¼‰

### 8.2 æµ‹è¯•æ–‡ä»¶ç»“æ„
```
tests/
â”œâ”€â”€ test_fetcher.py
â”œâ”€â”€ test_analyzer.py
â”œâ”€â”€ test_reporter.py
â”œâ”€â”€ test_notifier.py
â””â”€â”€ fixtures/
    â”œâ”€â”€ sample_holdings.csv
    â””â”€â”€ expected_report.md
```

## 9. Webhook æ¨é€çº¦æŸ

### 9.1 æ¶ˆæ¯æ ¼å¼
```python
{
    "msgtype": "markdown",
    "markdown": {
        "content": "# ARKK æŒä»“å˜åŒ–\n..."
    }
}
```

### 9.2 å¤±è´¥å¤„ç†
- 3æ¬¡é‡è¯•æœºåˆ¶
- æ¯æ¬¡é‡è¯•é—´éš” 5 ç§’
- å¤±è´¥åè®°å½•æ—¥å¿—ï¼Œä¸ä¸­æ–­ç¨‹åº

### 9.3 æµ‹è¯•æ¨¡å¼
```python
def test_webhook_connection():
    """æµ‹è¯• Webhook è¿æ¥æ˜¯å¦æ­£å¸¸"""
    test_message = {
        "msgtype": "text",
        "text": {"content": "Wood-ARK æµ‹è¯•æ¶ˆæ¯"}
    }
    response = requests.post(WEBHOOK_URL, json=test_message)
    return response.status_code == 200
```

## 10. å¼€å‘å·¥ä½œæµçº¦æŸ

### 10.1 æ–°åŠŸèƒ½å¼€å‘æµç¨‹
1. æ›´æ–° `PROJECT_DESIGN.md` è®¾è®¡æ–‡æ¡£
2. åœ¨å¯¹åº”æ¨¡å—æ·»åŠ åŠŸèƒ½ä»£ç 
3. ç¼–å†™å•å…ƒæµ‹è¯•
4. æ›´æ–° `README.md`ï¼ˆå¦‚æ¶‰åŠç”¨æˆ·ä½¿ç”¨ï¼‰
5. æäº¤ commitï¼ˆéµå¾ª Conventional Commitsï¼‰

### 10.2 ç¦æ­¢çš„æ“ä½œ
- âŒ è·³è¿‡è®¾è®¡ç›´æ¥å†™ä»£ç 
- âŒ ä¿®æ”¹æ¨¡å—èŒè´£è¾¹ç•Œ
- âŒ å¼•å…¥æœªç»æ‰¹å‡†çš„ç¬¬ä¸‰æ–¹ä¾èµ–
- âŒ ç¡¬ç¼–ç é…ç½®ä¿¡æ¯

---

**é¡¹ç›®åç§°**: Wood-ARK  
**æœ€åæ›´æ–°**: 2025-11-13  
**ç‰ˆæœ¬**: 1.0  
**é€‚ç”¨èŒƒå›´**: ä»…é™ Wood-ARK é¡¹ç›®