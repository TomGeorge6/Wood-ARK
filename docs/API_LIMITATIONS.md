# ARKFunds.io API 限制说明

## 📋 核心限制

### ⚠️ 只能获取当日数据

**ARKFunds.io API 不支持历史日期查询**

```python
# 测试结果
fetch_holdings('ARKK', '2025-11-15')  # 请求周五数据
→ 返回: 2025-11-17（今天）的数据

fetch_holdings('ARKK', '2025-11-11')  # 请求周一数据  
→ 返回: 2025-11-17（今天）的数据
```

**无论请求什么历史日期，API 都返回当日最新数据！**

---

## ❌ 无法实现的功能

### 1. 历史数据补齐

**场景**: 电脑关机 3 天，想补齐缺失的数据

**问题**:
```
周一关机 → 缺失 11-11 数据
周二关机 → 缺失 11-12 数据
周三关机 → 缺失 11-13 数据
周四开机 → 尝试补齐

fetch_holdings('ARKK', '2025-11-11')  # 想获取周一数据
→ 实际返回: 2025-11-14（周四）的数据
→ 保存为: 2025-11-11.csv
→ ❌ 文件内容是周四的数据，但文件名是周一！
```

**后果**: 数据时间穿越，趋势图错误

### 2. 周末数据补齐

**场景**: 周一补齐周六、周日数据

**问题**:
```
fetch_holdings('ARKK', '2025-11-16')  # 周六
→ 返回: 2025-11-18（周一）的数据
→ ❌ 周一数据被标记为周六

fetch_holdings('ARKK', '2025-11-17')  # 周日
→ 返回: 2025-11-18（周一）的数据
→ ❌ 周一数据被标记为周日
```

**后果**: 周六/日/周一的数据完全相同（都是周一的），破坏数据完整性

### 3. 批量历史下载

**场景**: 首次安装，想下载最近 90 天数据

**问题**:
```
for date in last_90_days:
    fetch_holdings('ARKK', date)

→ 所有 90 个文件内容完全相同（都是今天的数据）
→ ❌ 无法获得真实的历史趋势
```

---

## ✅ 正确的使用方式

### 每天定时运行，自然累积

**唯一有效策略**:

```
今天 (11-17) → 运行 → 保存 11-17.csv ✅ 真实数据
明天 (11-18) → 运行 → 保存 11-18.csv ✅ 真实数据
后天 (11-19) → 运行 → 保存 11-19.csv ✅ 真实数据
...
30 天后 → 拥有 30 天真实历史数据
90 天后 → 拥有 90 天真实历史数据
```

### 关键要求

1. **每天定时执行**: 使用 Launchd 或 Cron 定时任务
2. **保持电脑开机**: 至少工作日白天保持运行
3. **监控日志**: 定期检查执行是否成功
4. **接受缺失**: 关机期间的数据永久缺失，无法补齐

---

## 🎯 项目设计调整

### v2.1.2 变更

**移除的功能**:
- ❌ 自动补齐周末数据
- ❌ `--backfill` 批量下载
- ❌ `--check-missed` 交互式补齐

**保留的功能**:
- ✅ `--check-missed` 仅查看缺失（不补齐）
- ✅ 正常每日运行
- ✅ 数据准确性优先

### 设计理念

**数据准确性 > 数据完整性**

宁愿接受数据缺失，也不用错误数据填充。

---

## 💡 FAQ

### Q1: 为什么不在代码中标记数据来源日期？

**A**: 即使标记了数据是"补齐的"，内容仍然是错误的（周一的数据不应该出现在周六的文件中）。这会导致：
- 趋势图显示错误的变化
- 持仓分析结果不准确
- 用户误以为数据是真实的

### Q2: 其他 ARK 数据源可以获取历史数据吗？

**A**: 可能存在其他数据源（如 ARK 官网、Bloomberg、Yahoo Finance），但：
- ARKFunds.io 是官方推荐的免费 API
- 其他数据源可能需要付费或有更严格的访问限制
- 当前设计基于 ARKFunds.io，切换数据源需要重写 `DataFetcher`

### Q3: 能否保存 API 返回的实际日期，避免覆盖？

**A**: 可以，但这意味着：
```
请求 11-11 → 返回 11-17 → 保存为 11-17.csv
请求 11-12 → 返回 11-17 → 保存为 11-17.csv（覆盖）
请求 11-13 → 返回 11-17 → 保存为 11-17.csv（覆盖）

结果：只有今天的数据，缺失仍然存在
```

### Q4: 数据缺失会影响哪些功能？

**A**: 
- ✅ **不影响**: 每日报告、持仓变化分析、企业微信推送
- ⚠️ **部分影响**: 趋势图（matplotlib 会自动跳过缺失点）
- ❌ **完全影响**: 需要完整历史数据的统计分析

---

## 📚 相关文档

- [CHANGELOG.md](../CHANGELOG.md) - 版本变更记录
- [USAGE.md](USAGE.md) - 使用指南
- [README.md](../README.md) - 项目说明

---

**最后更新**: 2025-11-17  
**版本**: v2.1.2
