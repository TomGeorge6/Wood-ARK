# 变更日志

所有重要的项目变更都将记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

---

## [2.1.2] - 2025-11-17

### ⚠️ 重要变更

#### 完全移除补齐功能
- **原因**: ARKFunds.io API 只能获取当日数据，补齐会导致数据错乱
- **变更**: 
  - ✅ 移除所有自动补齐逻辑代码
  - ✅ `--check-missed` 改为仅查看模式，不提供补齐选项
  - ✅ `--backfill` 执行时直接提示已废弃并退出
  - ✅ `weekend_backfill.sh` 执行时直接提示已废弃并退出
- **影响**: 无法补齐电脑关机期间缺失的数据，必须每天定时运行

### 🔄 优化

- **数据准确性优先**: 只获取当天数据，确保数据准确性
- **简化逻辑**: 移除复杂的补齐判断和执行逻辑
- **清晰提示**: 所有废弃功能执行时给出明确提示

### 💡 建议

- ✅ **每天定时运行**：唯一获取历史数据的方式
- ✅ **保持电脑开机**：确保定时任务正常执行（至少工作日白天）
- ✅ **自然累积**：数据会随时间自然累积，30天后启用月度趋势图

---

## [2.1.1] - 2025-11-17 [已废弃]

### ⚠️ 重要变更

#### 禁用自动补齐功能
- **原因**: ARKFunds.io API 只能获取当日最新数据，无法获取历史指定日期数据
- **影响**: 补齐功能会导致用今天的数据覆盖历史日期文件，造成数据不准确
- **解决方案**: 完全禁用自动补齐，保持数据准确性优先

### 🔄 变更

- **移除**: 自动补齐周末数据功能（已禁用）
- **移除**: `scripts/weekend_backfill.sh` 脚本功能（保留文件但标记已废弃）
- **更新**: 文档说明 API 限制

### 📚 文档更新

- 更新 `README.md` - 移除自动补齐功能说明，添加 API 限制警告
- 更新 `USAGE.md` - 标记 `--check-missed` 功能已废弃
- 新增 `scripts/补齐逻辑说明.md` - 详细说明 API 限制和设计决策

### 💡 建议

- ✅ **每天定时运行**：唯一获取历史数据的方式
- ✅ **保持电脑开机**：确保定时任务正常执行
- ✅ **自然累积**：30天后启用1个月趋势图，90天后启用3个月趋势图

---

## [2.1.0] - 2025-11-17 [已废弃]

### 🆕 新增（已废弃）

#### ~~自动补齐周末数据~~（因 API 限制已禁用）
- ~~智能检测: 每次运行时自动检测最近 7 天缺失的数据~~
- ~~自动补齐: 无需手动干预，周一运行时自动补齐周末数据~~
- ~~状态标记: 补齐后自动标记推送状态，避免重复执行~~

**废弃原因**: API 不支持历史日期查询，补齐会产生错误数据

#### 部署改进（仍有效）
- **动态时间配置**: `setup_launchd.sh` 从 `config.yaml` 读取执行时间
- **智能配置**: 支持自定义执行时间（如 11:00）

---

## [2.0.0] - 2025-11-14

### 🆕 新增

#### ARK 全系列基金汇总报告
- **核心持仓 Top 10**: 展示跨基金重叠股票，按持有基金数量排序
- **各基金快速对比**: 并排显示5只基金的 Top 10 持仓
- **今日亮点**: 自动识别重大变化（新增重叠、多基金同时增持等）
- **统计摘要**: 总持仓数、跨基金重叠数、单基金独有数

#### 长图报告
- **基金总市值趋势**: 显示最近 30 天/90 天的资产变化
- **Top 10 个股持股数趋势**: 1个月 + 3个月双图对比
- **新增持仓股票趋势**: 追踪新建仓位的持股数变化
- **持仓变化柱状图**: 可视化显著增持/减持

#### 自动化工具
- **一键部署脚本** (`scripts/setup_launchd.sh`): 自动配置 Launchd 定时任务
- **数据完整性检查** (`scripts/check_data_integrity.py`): 检测缺失日期

#### 命令行参数
- `--skip-summary`: 跳过汇总报告
- `--skip-notification`: 跳过企业微信推送
- `--check-missed`: 检查缺失的数据日期

### 🐛 修复

- **CSV 格式问题**: 修复保存时缺少逗号分隔符的问题（添加 `sep=','` 参数）
- **历史数据下载**: 优化从 GitHub 镜像下载逻辑，智能检测分隔符类型
- **重试机制**: 增强网络请求的容错能力

### 📊 变更

- **Top 3 → Top 10**: 汇总报告中各基金显示 Top 10 持仓（原为 Top 3）
- **权重趋势 → 持股数趋势**: 所有趋势图改为显示持股数（原为权重百分比）
- **Y轴格式化**: 持股数显示为 M/K 单位（如 1.2M, 345K）

### 🔄 优化

- **推送格式**: 6条消息（1个汇总 + 5个单基金长图）
- **数据源**: 主数据源改为 ARKFunds.io API（更稳定）
- **日志输出**: 更清晰的进度提示和错误信息

### 📚 文档

- **使用指南** (`docs/USAGE.md`): 详细的命令行参数说明
- **部署指南** (`docs/DEPLOYMENT.md`): 包含数据累积策略说明
- **FAQ** (`docs/FAQ.md`): 常见问题解答（包含历史数据说明）

---

## [1.0.0] - 2025-11-13

### 🆕 初始版本

#### 核心功能
- **自动数据采集**: 每日从 ARK Invest 官方数据源下载持仓数据
- **持仓变化分析**: 对比前后两日数据，识别新增/移除/增持/减持
- **Markdown 报告**: 生成格式化的持仓变化报告
- **企业微信推送**: 通过 Webhook 推送每日报告

#### 支持的 ETF
- ARKK (ARK Innovation ETF) ⭐ 旗舰基金
- ARKW (ARK Next Generation Internet ETF)
- ARKG (ARK Genomic Revolution ETF)
- ARKQ (ARK Autonomous Tech & Robotics ETF)
- ARKF (ARK Fintech Innovation ETF)

#### 数据管理
- **本地存储**: CSV 格式保存持仓数据
- **历史数据**: 支持从 GitHub 镜像下载历史数据
- **自动清理**: 默认保留 90 天数据

#### 调度功能
- **工作日检测**: 自动识别周一到周五（美东时间）
- **定时任务**: 支持 Cron/Launchd 定时执行
- **手动模式**: 支持强制执行（`--manual` 参数）

#### 配置管理
- **YAML 配置**: `config.yaml` 集中管理所有参数
- **环境变量**: `.env` 文件管理敏感信息（Webhook URL）
- **灵活阈值**: 可配置显著变化阈值（默认 5%）

---

## [Unreleased] - 未来计划

### 🚀 计划新增

- **邮件推送**: 支持通过邮件发送报告（备选通知方式）
- **Web 界面**: 简单的 Web UI 查看历史报告
- **数据分析**: 统计木头姐的持仓偏好（行业、市值分布等）
- **警报功能**: 特定股票达到阈值时发送通知

### 🔄 计划优化

- **多数据源**: 支持从多个 API 获取数据（提高可靠性）
- **增量下载**: 只下载变化的部分（节省带宽）
- **缓存机制**: 减少重复计算

---

## 版本说明

### 版本号格式

- **主版本号**: 重大架构变更或不兼容的 API 修改
- **次版本号**: 新增功能，向后兼容
- **修订号**: Bug 修复和小优化

### 类型标记

- 🆕 新增: 新功能
- 🐛 修复: Bug 修复
- 📊 变更: 功能变更
- 🔄 优化: 性能或体验优化
- 📚 文档: 文档更新
- 🔒 安全: 安全相关修复
- ⚠️ 废弃: 即将移除的功能

---

## 数据迁移说明

### v1.0 → v2.0

**无需迁移**，向后兼容。

**可选优化**:
1. 清空旧数据重新下载（确保 CSV 格式正确）:
   ```bash
   rm -rf data/holdings/*
   python3 main.py --backfill --days 90
   ```

2. 重新配置定时任务（使用新的部署脚本）:
   ```bash
   ./scripts/setup_launchd.sh
   ```

---

**最后更新**: 2025-11-14  
**项目地址**: `/Users/lucian/Documents/个人/Investment/Tools/Wood-ARK`
